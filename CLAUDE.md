# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is the Flipt Client SDKs repository - a collection of client-side evaluation SDKs for the Flipt feature flag system. The repository contains multiple language implementations that wrap Rust-based evaluation engines.

## Architecture

The project uses a multi-layered architecture:

1. **Core Evaluation Engine** (`flipt-evaluation/`): Rust library containing the core evaluation logic
2. **Engine Implementations**:
   - **FFI Engine** (`flipt-engine-ffi/`): For native platform integration via Foreign Function Interface
   - **WASM Engine** (`flipt-engine-wasm/`): WebAssembly for non-JS environments
   - **WASM JS Engine** (`flipt-engine-wasm-js/`): WebAssembly optimized for JavaScript environments
3. **Language Clients**: Thin wrappers in various languages that interface with the engines

## Supported Languages

- **FFI-based**: Python, Ruby, Java, C#, Dart/Flutter, Kotlin (Android), Swift (iOS)
- **WASM-based**: Go, JavaScript, Node.js, React, Browser

## Common Development Commands

### Rust (Core Engines)

```bash
# Build all Rust components
cargo build --release

# Run tests
cargo test --all-features

# Format code
cargo fmt --all

# Lint code
cargo clippy --all -- -D warnings

# Test WASM JS engine specifically
cd flipt-engine-wasm-js && wasm-pack test --node
```

### Integration Tests

```bash
# Run all integration tests
dagger run go run ./test

# Run specific SDK tests
dagger run go run ./test -sdks python,ruby

# Run by implementation group
dagger run go run ./test -groups ffi,wasm,js
```

## Test Groups

- `ffi`: Python, Ruby, Java, Dart, C# (FFI-based SDKs)
- `wasm`: Go (Direct WASM)
- `js`: Node, Browser, React (JavaScript WASM bindings)

## File Structure

- `flipt-evaluation/`: Core evaluation logic in Rust
- `flipt-engine-*/`: Engine implementations (FFI, WASM, WASM-JS)
- `flipt-client-*/`: Language-specific client implementations
- `test/`: Integration test infrastructure using Dagger
- `package/`: Build tooling for packaging engines
- `release/`: Release automation scripts

## Key Implementation Patterns

### Client Interface

All clients implement a standard interface:

- `EvaluateVariant`: Evaluates multi-variant flags
- `EvaluateBoolean`: Evaluates boolean flags
- `EvaluateBatch`: Evaluates multiple flags in one call
- `ListFlags`: Returns available flags
- `GetSnapshot`: Returns current flag state (if supported)
- `Close`: Cleanup method

### Engine Integration

- **FFI clients**: Link to native libraries, handle state polling/streaming
- **WASM clients**: Embed WASM module, handle state fetching from client side

## Development Workflow

1. Changes to core evaluation logic go in `flipt-evaluation/`
2. Engine changes go in respective `flipt-engine-*/` directories
3. Client changes go in `flipt-client-*/` directories
4. Use integration tests to verify cross-language compatibility
5. Create a new branch for your changes
6. Follow conventional commits for commit messages prefer shorter commit messages over longer ones
7. Always use the `-s` flag when creating a commit
8. Don't mention Claude or that the code was generated by Claude Code in the commit message or in the PR description
9. Create a PR for your changes using the `gh pr create` command. Give detailed description of the changes and why you made them. Again, don't mention Claude or that the code was generated by Claude Code in the PR description.

## Build Dependencies

- Rust toolchain (for engines)
- wasm-pack (for WASM builds)
- Docker (for integration tests)
- Dagger CLI (for integration tests)
- Language-specific toolchains as needed
